<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tetris Optimizer | Tetromino Packing Solver</title>
  <meta name="description" content="Pack Tetris pieces into the smallest possible square grid using backtracking algorithm. Built with Go, zero dependencies.">
  <style>
    :root {
      --bg-primary: #0d1117;
      --bg-secondary: #161b22;
      --bg-tertiary: #21262d;
      --border: #30363d;
      --text-primary: #e6edf3;
      --text-secondary: #8b949e;
      --accent: #58a6ff;
      --accent-hover: #79b8ff;
      --success: #3fb950;
      --error: #f85149;
      --warning: #d29922;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      line-height: 1.6;
    }

    .container {
      max-width: 1000px;
      margin: 0 auto;
      padding: 0 1.5rem;
    }

    /* === HERO SECTION === */
    .hero {
      text-align: center;
      padding: 4rem 1.5rem 3rem;
      border-bottom: 1px solid var(--border);
    }

    .hero h1 {
      font-size: 2.5rem;
      margin-bottom: 0.75rem;
    }

    .hero-emoji {
      font-size: 2.5rem;
      margin-right: 0.5rem;
    }

    .tagline {
      font-size: 1.25rem;
      color: var(--text-secondary);
      margin-bottom: 1.5rem;
    }

    .badges {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 0.5rem;
      margin-bottom: 1.5rem;
    }

    .badge {
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: 20px;
      padding: 0.35rem 0.75rem;
      font-size: 0.8rem;
      color: var(--text-secondary);
      text-decoration: none;
      transition: border-color 0.2s;
    }

    .badge:hover {
      border-color: var(--accent);
    }

    .badge-icon {
      font-size: 0.9rem;
    }

    .cta-buttons {
      display: flex;
      justify-content: center;
      gap: 1rem;
      flex-wrap: wrap;
    }

    .cta {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.75rem 1.5rem;
      border-radius: 6px;
      font-weight: 600;
      text-decoration: none;
      transition: all 0.2s;
    }

    .cta-primary {
      background: var(--accent);
      color: var(--bg-primary);
    }

    .cta-primary:hover {
      background: var(--accent-hover);
    }

    .cta-secondary {
      background: var(--bg-secondary);
      color: var(--text-primary);
      border: 1px solid var(--border);
    }

    .cta-secondary:hover {
      border-color: var(--accent);
    }

    /* === SECTIONS === */
    section {
      padding: 3rem 0;
      border-bottom: 1px solid var(--border);
    }

    section:last-child {
      border-bottom: none;
    }

    h2 {
      font-size: 1.5rem;
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    h3 {
      font-size: 1.1rem;
      margin-bottom: 0.5rem;
      color: var(--text-primary);
    }

    p {
      color: var(--text-secondary);
      margin-bottom: 1rem;
    }

    /* === OVERVIEW === */
    .overview-content {
      max-width: 700px;
    }

    .highlight {
      color: var(--accent);
      font-weight: 500;
    }

    /* === DEMO === */
    .demo-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1.5rem;
    }

    @media (max-width: 700px) {
      .demo-grid {
        grid-template-columns: 1fr;
      }
    }

    .panel {
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: 6px;
      padding: 1rem;
    }

    .panel-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.75rem;
    }

    .panel-title {
      font-size: 0.875rem;
      font-weight: 600;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    textarea {
      width: 100%;
      height: 240px;
      background: var(--bg-tertiary);
      border: 1px solid var(--border);
      border-radius: 4px;
      color: var(--text-primary);
      font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;
      font-size: 14px;
      padding: 0.75rem;
      resize: vertical;
    }

    textarea:focus {
      outline: none;
      border-color: var(--accent);
    }

    select {
      background: var(--bg-tertiary);
      border: 1px solid var(--border);
      border-radius: 4px;
      color: var(--text-primary);
      padding: 0.25rem 0.5rem;
      font-size: 0.8rem;
      cursor: pointer;
    }

    .btn {
      background: var(--accent);
      color: var(--bg-primary);
      border: none;
      border-radius: 6px;
      padding: 0.75rem 1.5rem;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      width: 100%;
      margin-top: 1rem;
      transition: opacity 0.2s;
    }

    .btn:hover {
      opacity: 0.9;
    }

    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .output-area {
      min-height: 240px;
      display: flex;
      flex-direction: column;
    }

    .board-container {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--bg-tertiary);
      border-radius: 4px;
      padding: 1rem;
    }

    .board {
      display: grid;
      gap: 2px;
      font-family: monospace;
      font-size: 1.1rem;
    }

    .cell {
      width: 26px;
      height: 26px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 3px;
      font-weight: bold;
    }

    .cell.empty {
      background: var(--bg-secondary);
      color: var(--text-secondary);
    }

    .status {
      text-align: center;
      padding: 1rem;
      color: var(--text-secondary);
    }

    .status.error {
      color: var(--error);
    }

    .status.success {
      color: var(--success);
    }

    .stats {
      margin-top: 0.75rem;
      padding-top: 0.75rem;
      border-top: 1px solid var(--border);
      font-size: 0.85rem;
      color: var(--text-secondary);
      display: flex;
      justify-content: space-between;
    }

    /* === QUICK START === */
    .code-block {
      background: var(--bg-tertiary);
      border: 1px solid var(--border);
      border-radius: 6px;
      padding: 1rem;
      overflow-x: auto;
      font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;
      font-size: 0.875rem;
      color: var(--text-primary);
      margin-bottom: 1rem;
    }

    .code-block code {
      white-space: pre;
    }

    .code-comment {
      color: var(--text-secondary);
    }

    /* === HOW IT WORKS === */
    .steps {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1.5rem;
      margin-top: 1.5rem;
    }

    .step {
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: 6px;
      padding: 1.25rem;
    }

    .step-number {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 28px;
      height: 28px;
      background: var(--accent);
      color: var(--bg-primary);
      border-radius: 50%;
      font-weight: 700;
      font-size: 0.875rem;
      margin-bottom: 0.75rem;
    }

    .step h3 {
      margin-bottom: 0.5rem;
    }

    .step p {
      font-size: 0.9rem;
      margin-bottom: 0;
    }

    /* === FEATURES === */
    .features-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 1rem;
      margin-top: 1rem;
    }

    .feature {
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: 6px;
      padding: 1.25rem;
    }

    .feature-icon {
      font-size: 1.5rem;
      margin-bottom: 0.5rem;
    }

    .feature h3 {
      margin-bottom: 0.5rem;
    }

    .feature p {
      font-size: 0.9rem;
      margin-bottom: 0;
    }

    /* === SHAPES REFERENCE === */
    .shapes-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
      gap: 1rem;
      margin-top: 1rem;
    }

    .shape-item {
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: 6px;
      padding: 0.75rem;
      text-align: center;
    }

    .shape-preview {
      font-family: monospace;
      font-size: 0.7rem;
      line-height: 1.2;
      color: var(--accent);
      margin-bottom: 0.25rem;
      white-space: pre;
    }

    .shape-name {
      font-size: 0.75rem;
      color: var(--text-secondary);
    }

    /* === DOCUMENTATION === */
    .doc-links {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      margin-top: 1rem;
    }

    .doc-link {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.75rem 1.25rem;
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: 6px;
      color: var(--text-primary);
      text-decoration: none;
      transition: border-color 0.2s;
    }

    .doc-link:hover {
      border-color: var(--accent);
    }

    /* === FOOTER === */
    footer {
      text-align: center;
      padding: 2rem 1.5rem;
      color: var(--text-secondary);
      font-size: 0.85rem;
    }

    footer a {
      color: var(--accent);
      text-decoration: none;
    }

    footer a:hover {
      text-decoration: underline;
    }

    /* Piece colors */
    .piece-A { background: #f87171; color: #1a1a1a; }
    .piece-B { background: #fb923c; color: #1a1a1a; }
    .piece-C { background: #facc15; color: #1a1a1a; }
    .piece-D { background: #a3e635; color: #1a1a1a; }
    .piece-E { background: #4ade80; color: #1a1a1a; }
    .piece-F { background: #2dd4bf; color: #1a1a1a; }
    .piece-G { background: #22d3ee; color: #1a1a1a; }
    .piece-H { background: #60a5fa; color: #1a1a1a; }
    .piece-I { background: #a78bfa; color: #1a1a1a; }
    .piece-J { background: #e879f9; color: #1a1a1a; }
    .piece-K { background: #fb7185; color: #1a1a1a; }
    .piece-L { background: #f472b6; color: #1a1a1a; }
    .piece-M { background: #c084fc; color: #1a1a1a; }
    .piece-N { background: #818cf8; color: #1a1a1a; }
    .piece-O { background: #38bdf8; color: #1a1a1a; }
    .piece-P { background: #34d399; color: #1a1a1a; }
    .piece-Q { background: #a8a29e; color: #1a1a1a; }
    .piece-R { background: #fbbf24; color: #1a1a1a; }
    .piece-S { background: #f97316; color: #1a1a1a; }
    .piece-T { background: #ef4444; color: #1a1a1a; }
    .piece-U { background: #ec4899; color: #1a1a1a; }
    .piece-V { background: #8b5cf6; color: #1a1a1a; }
    .piece-W { background: #6366f1; color: #1a1a1a; }
    .piece-X { background: #0ea5e9; color: #1a1a1a; }
    .piece-Y { background: #14b8a6; color: #1a1a1a; }
    .piece-Z { background: #84cc16; color: #1a1a1a; }
  </style>
</head>
<body>

  <!-- HERO -->
  <header class="hero">
    <h1><span class="hero-emoji">üß©</span>Tetris Optimizer</h1>
    <p class="tagline">Pack Tetris pieces into the smallest possible square grid</p>

    <div class="badges">
      <span class="badge"><span class="badge-icon">üî∑</span> Go 1.21+</span>
      <a href="https://github.com/terry-xyz/tetris-optimizer/blob/main/LICENSE" class="badge"><span class="badge-icon">üìÑ</span> MIT License</a>
      <span class="badge"><span class="badge-icon">üì¶</span> Zero Dependencies</span>
      <a href="https://github.com/terry-xyz/tetris-optimizer/actions" class="badge"><span class="badge-icon">‚úÖ</span> CI/CD Pipeline</a>
      <span class="badge"><span class="badge-icon">‚è±Ô∏è</span> 5-min Timeout</span>
    </div>

    <div class="cta-buttons">
      <a href="https://github.com/terry-xyz/tetris-optimizer" class="cta cta-secondary">
        <span>‚≠ê</span> View on GitHub
      </a>
      <a href="#demo" class="cta cta-primary">
        <span>‚ñ∂Ô∏è</span> Try Demo
      </a>
    </div>
  </header>

  <main class="container">

    <!-- OVERVIEW -->
    <section id="overview">
      <h2>üöÄ Overview</h2>
      <div class="overview-content">
        <p>
          <strong>Tetris Optimizer</strong> solves the <span class="highlight">tetromino packing problem</span>:
          given a set of Tetris pieces, find the smallest square grid where they all fit without overlapping.
        </p>
        <p>
          Uses a <span class="highlight">backtracking algorithm</span> that tries placing pieces one by one,
          undoing and retrying when stuck. Starts with the minimum possible board size and grows until a solution is found.
        </p>
        <p>
          Perfect for: algorithm learning, puzzle solving, understanding recursion, or just having fun with Tetris shapes.
        </p>
      </div>
    </section>

    <!-- LIVE DEMO -->
    <section id="demo">
      <h2>üßÆ Live Demo</h2>
      <div class="demo-grid">
        <div class="panel">
          <div class="panel-header">
            <span class="panel-title">Input</span>
            <select id="examples" onchange="loadExample()">
              <option value="">-- Examples --</option>
              <option value="single">Single O-piece</option>
              <option value="two">Two pieces</option>
              <option value="four">Four pieces</option>
              <option value="complex">Complex (6 pieces)</option>
            </select>
          </div>
          <textarea id="input" placeholder="Enter tetrominoes here...

Format: 4x4 grid per piece
# = filled, . = empty
Blank line between pieces

Example O-piece:
##..
##..
....
...."></textarea>
          <button class="btn" id="solveBtn" onclick="solve()">Solve</button>
        </div>

        <div class="panel">
          <div class="panel-header">
            <span class="panel-title">Output</span>
          </div>
          <div class="output-area">
            <div class="board-container" id="boardContainer">
              <div class="status" id="status">Select an example or enter tetrominoes</div>
            </div>
            <div class="stats" id="stats" style="display: none;">
              <span id="sizeInfo"></span>
              <span id="emptyInfo"></span>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- QUICK START -->
    <section id="quickstart">
      <h2>‚ö° Quick Start</h2>
      <div class="code-block"><code><span class="code-comment"># Clone and run</span>
git clone https://github.com/terry-xyz/tetris-optimizer.git
cd tetris-optimizer
go run ./cmd input.txt

<span class="code-comment"># Run tests</span>
go test ./...

<span class="code-comment"># Build binary</span>
go build -o tetris-optimizer ./cmd</code></div>
    </section>

    <!-- HOW IT WORKS -->
    <section id="algorithm">
      <h2>üîç How It Works</h2>
      <p>The solver uses a backtracking algorithm ‚Äî a systematic way to try all possibilities:</p>

      <div class="steps">
        <div class="step">
          <div class="step-number">1</div>
          <h3>Parse Input</h3>
          <p>Read tetromino definitions, validate against 19 canonical shapes, normalize coordinates.</p>
        </div>
        <div class="step">
          <div class="step-number">2</div>
          <h3>Calculate Min Size</h3>
          <p>Start with ceiling of ‚àö(4 √ó pieces). Each piece = 4 cells, so 4 pieces need at least a 4√ó4 board.</p>
        </div>
        <div class="step">
          <div class="step-number">3</div>
          <h3>Try Placements</h3>
          <p>For each piece, try every position. If it fits without collision, place it and recurse to next piece.</p>
        </div>
        <div class="step">
          <div class="step-number">4</div>
          <h3>Backtrack</h3>
          <p>If stuck (no valid position), undo the last placement and try a different spot. If all fails, try larger board.</p>
        </div>
      </div>
    </section>

    <!-- FEATURES -->
    <section id="features">
      <h2>üéØ Features</h2>
      <div class="features-grid">
        <div class="feature">
          <div class="feature-icon">‚ö°</div>
          <h3>Lightning Fast</h3>
          <p>Pure Go standard library, zero external dependencies, optimized bounds checking.</p>
        </div>
        <div class="feature">
          <div class="feature-icon">üõ°Ô∏è</div>
          <h3>Robust Validation</h3>
          <p>Validates all 19 rotational variants, handles CRLF line endings, detailed error messages.</p>
        </div>
        <div class="feature">
          <div class="feature-icon">‚è±Ô∏è</div>
          <h3>Timeout Protection</h3>
          <p>5-minute hard limit prevents infinite runs. Graceful Ctrl+C handling.</p>
        </div>
        <div class="feature">
          <div class="feature-icon">üìä</div>
          <h3>Progress Bar</h3>
          <p>TTY-detected progress display shows remaining time while solving complex puzzles.</p>
        </div>
      </div>
    </section>

    <!-- 19 SHAPES -->
    <section id="shapes">
      <h2>üî∑ The 19 Valid Shapes</h2>
      <p>Tetrominoes have 7 base shapes, but counting rotations there are 19 unique variants the solver accepts:</p>

      <div class="shapes-grid">
        <div class="shape-item"><div class="shape-preview">####</div><div class="shape-name">I horiz</div></div>
        <div class="shape-item"><div class="shape-preview">#
#
#
#</div><div class="shape-name">I vert</div></div>
        <div class="shape-item"><div class="shape-preview">##
##</div><div class="shape-name">O</div></div>
        <div class="shape-item"><div class="shape-preview">###
 #</div><div class="shape-name">T down</div></div>
        <div class="shape-item"><div class="shape-preview">#
##
#</div><div class="shape-name">T right</div></div>
        <div class="shape-item"><div class="shape-preview"> #
###</div><div class="shape-name">T up</div></div>
        <div class="shape-item"><div class="shape-preview"> #
##
 #</div><div class="shape-name">T left</div></div>
        <div class="shape-item"><div class="shape-preview"> ##
##</div><div class="shape-name">S horiz</div></div>
        <div class="shape-item"><div class="shape-preview">#
##
 #</div><div class="shape-name">S vert</div></div>
        <div class="shape-item"><div class="shape-preview">##
 ##</div><div class="shape-name">Z horiz</div></div>
        <div class="shape-item"><div class="shape-preview"> #
##
#</div><div class="shape-name">Z vert</div></div>
        <div class="shape-item"><div class="shape-preview">#
#
##</div><div class="shape-name">L up</div></div>
        <div class="shape-item"><div class="shape-preview">###
#</div><div class="shape-name">L right</div></div>
        <div class="shape-item"><div class="shape-preview">##
 #
 #</div><div class="shape-name">L down</div></div>
        <div class="shape-item"><div class="shape-preview">  #
###</div><div class="shape-name">L left</div></div>
        <div class="shape-item"><div class="shape-preview"> #
 #
##</div><div class="shape-name">J up</div></div>
        <div class="shape-item"><div class="shape-preview">#
###</div><div class="shape-name">J right</div></div>
        <div class="shape-item"><div class="shape-preview">##
#
#</div><div class="shape-name">J down</div></div>
        <div class="shape-item"><div class="shape-preview">###
  #</div><div class="shape-name">J left</div></div>
      </div>
    </section>

    <!-- DOCUMENTATION -->
    <section id="docs">
      <h2>üìñ Documentation</h2>
      <p>Everything you need to understand, use, and contribute:</p>

      <div class="doc-links">
        <a href="https://github.com/terry-xyz/tetris-optimizer/blob/main/README.md" class="doc-link">
          <span>üìÑ</span> README
        </a>
        <a href="https://github.com/terry-xyz/tetris-optimizer/blob/main/CONTRIBUTING.md" class="doc-link">
          <span>ü§ù</span> Contributing
        </a>
        <a href="https://github.com/terry-xyz/tetris-optimizer/blob/main/LICENSE" class="doc-link">
          <span>üìú</span> License
        </a>
        <a href="https://github.com/terry-xyz/tetris-optimizer/issues" class="doc-link">
          <span>üêõ</span> Issues
        </a>
        <a href="https://github.com/terry-xyz/tetris-optimizer/tree/main/teachings" class="doc-link">
          <span>üìö</span> Learning Guide
        </a>
      </div>
    </section>

  </main>

  <footer>
    <p>
      Built with ‚ù§Ô∏è using Go &nbsp;¬∑&nbsp;
      <a href="https://github.com/terry-xyz/tetris-optimizer">GitHub</a> &nbsp;¬∑&nbsp;
      <a href="https://github.com/terry-xyz/tetris-optimizer/blob/main/LICENSE">MIT License</a>
    </p>
  </footer>

  <script>
    // === 19 Canonical Tetromino Shapes ===
    const CANONICAL_SHAPES = [
      [[0,0], [0,1], [0,2], [0,3]], [[0,0], [1,0], [2,0], [3,0]],
      [[0,0], [0,1], [1,0], [1,1]],
      [[0,0], [0,1], [0,2], [1,1]], [[0,0], [1,0], [1,1], [2,0]],
      [[0,1], [1,0], [1,1], [1,2]], [[0,1], [1,0], [1,1], [2,1]],
      [[0,1], [0,2], [1,0], [1,1]], [[0,0], [1,0], [1,1], [2,1]],
      [[0,0], [0,1], [1,1], [1,2]], [[0,1], [1,0], [1,1], [2,0]],
      [[0,0], [1,0], [2,0], [2,1]], [[0,0], [0,1], [0,2], [1,0]],
      [[0,0], [0,1], [1,1], [2,1]], [[0,2], [1,0], [1,1], [1,2]],
      [[0,1], [1,1], [2,0], [2,1]], [[0,0], [1,0], [1,1], [1,2]],
      [[0,0], [0,1], [1,0], [2,0]], [[0,0], [0,1], [0,2], [1,2]]
    ];

    const EXAMPLES = {
      single: `##..
##..
....
....`,
      two: `##..
##..
....
....

....
####
....
....`,
      four: `...#
...#
...#
...#

....
....
..##
..##

....
....
....
####

....
##..
.#..
.#..`,
      complex: `##..
.##.
....
....

.##.
##..
....
....

##..
##..
....
....

....
####
....
....

#...
###.
....
....

....
###.
..#.
....`
    };

    function parseInput(text) {
      const lines = text.replace(/\r/g, '').split('\n');
      while (lines.length > 0 && lines[lines.length - 1] === '') lines.pop();
      if (lines.length === 0) throw new Error('Empty input');

      const pieces = [];
      let i = 0, pieceNum = 0;

      while (i < lines.length) {
        pieceNum++;
        if (pieceNum > 26) throw new Error('Too many pieces (max 26)');
        if (i + 4 > lines.length) throw new Error(`Piece ${pieceNum}: incomplete`);

        const pieceLines = lines.slice(i, i + 4);
        i += 4;

        for (let j = 0; j < 4; j++) {
          if (pieceLines[j].length !== 4) throw new Error(`Piece ${pieceNum}, line ${j + 1}: expected 4 chars`);
          for (const ch of pieceLines[j]) if (ch !== '#' && ch !== '.') throw new Error(`Piece ${pieceNum}: invalid char '${ch}'`);
        }

        const coords = [];
        for (let r = 0; r < 4; r++) for (let c = 0; c < 4; c++) if (pieceLines[r][c] === '#') coords.push([r, c]);
        if (coords.length !== 4) throw new Error(`Piece ${pieceNum}: has ${coords.length} cells (expected 4)`);

        const normalized = normalize(coords);
        if (!matchShape(normalized)) throw new Error(`Piece ${pieceNum}: invalid shape`);

        pieces.push({ label: String.fromCharCode(65 + pieceNum - 1), coords: normalized });

        if (i < lines.length) {
          if (lines[i] !== '') throw new Error(`Missing blank line after piece ${pieceNum}`);
          i++;
          if (i < lines.length && lines[i] === '') throw new Error('Consecutive blank lines not allowed');
        }
      }
      if (pieces.length === 0) throw new Error('No tetrominoes found');
      return pieces;
    }

    function normalize(coords) {
      if (coords.length === 0) return coords;
      let minRow = coords[0][0], minCol = coords[0][1];
      for (const [r, c] of coords) { if (r < minRow) minRow = r; if (c < minCol) minCol = c; }
      const normalized = coords.map(([r, c]) => [r - minRow, c - minCol]);
      normalized.sort((a, b) => a[0] !== b[0] ? a[0] - b[0] : a[1] - b[1]);
      return normalized;
    }

    function matchShape(coords) {
      if (coords.length !== 4) return false;
      for (const shape of CANONICAL_SHAPES) if (pointsEqual(coords, shape)) return true;
      return false;
    }

    function pointsEqual(a, b) {
      if (a.length !== b.length) return false;
      for (let i = 0; i < a.length; i++) if (a[i][0] !== b[i][0] || a[i][1] !== b[i][1]) return false;
      return true;
    }

    function createBoard(size) {
      const grid = [];
      for (let i = 0; i < size; i++) grid.push(new Array(size).fill('.'));
      return { grid, size };
    }

    function copyBoard(board) {
      return { grid: board.grid.map(row => [...row]), size: board.size };
    }

    function canPlace(board, piece, row, col) {
      for (const [r, c] of piece.coords) {
        const newR = row + r, newC = col + c;
        if (newR < 0 || newR >= board.size || newC < 0 || newC >= board.size) return false;
      }
      for (const [r, c] of piece.coords) if (board.grid[row + r][col + c] !== '.') return false;
      return true;
    }

    function place(board, piece, row, col) {
      for (const [r, c] of piece.coords) board.grid[row + r][col + c] = piece.label;
    }

    function solvePuzzle(pieces, maxTime = 5000) {
      if (pieces.length === 0) return { board: createBoard(0), timeout: false };
      const minSize = Math.ceil(Math.sqrt(4 * pieces.length));
      const startTime = Date.now();

      for (let size = minSize; size <= 20; size++) {
        if (Date.now() - startTime > maxTime) return { board: null, timeout: true };
        const board = createBoard(size);
        if (solveRecursive(board, pieces, 0, startTime, maxTime)) return { board, timeout: false };
      }
      return { board: null, timeout: true };
    }

    function solveRecursive(board, pieces, idx, startTime, maxTime) {
      if (Date.now() - startTime > maxTime) return false;
      if (idx >= pieces.length) return true;
      const piece = pieces[idx];

      for (let row = 0; row < board.size; row++) {
        for (let col = 0; col < board.size; col++) {
          if (canPlace(board, piece, row, col)) {
            const newBoard = copyBoard(board);
            place(newBoard, piece, row, col);
            if (solveRecursive(newBoard, pieces, idx + 1, startTime, maxTime)) {
              board.grid = newBoard.grid;
              return true;
            }
          }
        }
      }
      return false;
    }

    function loadExample() {
      const select = document.getElementById('examples');
      if (select.value && EXAMPLES[select.value]) document.getElementById('input').value = EXAMPLES[select.value];
      select.value = '';
    }

    function solve() {
      const input = document.getElementById('input').value;
      const container = document.getElementById('boardContainer');
      const stats = document.getElementById('stats');
      const btn = document.getElementById('solveBtn');

      btn.disabled = true;
      btn.textContent = 'Solving...';
      container.innerHTML = '<div class="status">Solving...</div>';
      stats.style.display = 'none';

      setTimeout(() => {
        try {
          const pieces = parseInput(input);
          const result = solvePuzzle(pieces);

          if (result.timeout) {
            container.innerHTML = '<div class="status error">TIMEOUT - try fewer pieces</div>';
          } else {
            renderBoard(result.board, container);
            const emptyCount = countEmpty(result.board);
            document.getElementById('sizeInfo').textContent = `Size: ${result.board.size}√ó${result.board.size}`;
            document.getElementById('emptyInfo').textContent = `Empty: ${emptyCount} cell${emptyCount !== 1 ? 's' : ''}`;
            stats.style.display = 'flex';
          }
        } catch (e) {
          container.innerHTML = `<div class="status error">ERROR: ${e.message}</div>`;
        }
        btn.disabled = false;
        btn.textContent = 'Solve';
      }, 10);
    }

    function renderBoard(board, container) {
      if (board.size === 0) { container.innerHTML = '<div class="status success">Empty solution</div>'; return; }
      const boardEl = document.createElement('div');
      boardEl.className = 'board';
      boardEl.style.gridTemplateColumns = `repeat(${board.size}, 26px)`;

      for (let r = 0; r < board.size; r++) {
        for (let c = 0; c < board.size; c++) {
          const cell = document.createElement('div');
          const value = board.grid[r][c];
          cell.className = 'cell';
          if (value === '.') { cell.classList.add('empty'); cell.textContent = '.'; }
          else { cell.classList.add(`piece-${value}`); cell.textContent = value; }
          boardEl.appendChild(cell);
        }
      }
      container.innerHTML = '';
      container.appendChild(boardEl);
    }

    function countEmpty(board) {
      let count = 0;
      for (const row of board.grid) for (const cell of row) if (cell === '.') count++;
      return count;
    }
  </script>
</body>
</html>
