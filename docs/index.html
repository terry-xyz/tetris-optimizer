<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tetris Optimizer | Tetromino Packing Solver</title>
  <meta name="description" content="Pack Tetris pieces into the smallest possible square grid using backtracking algorithm. Built with Go, zero dependencies.">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=DM+Serif+Display&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg-cream: #FAF9F6;
      --bg-card: #1a1a1a;
      --green-dark: #1B4332;
      --green-light: #2D6A4F;
      --orange: #E9A319;
      --text-dark: #1a1a1a;
      --text-light: #FAF9F6;
      --text-muted: #6b7280;
      --purple: #C9B8E8;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'DM Sans', -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--bg-cream);
      color: var(--text-dark);
      line-height: 1.6;
    }

    .container {
      max-width: 1100px;
      margin: 0 auto;
      padding: 0 1.5rem;
    }

    /* === HERO === */
    .hero {
      text-align: center;
      padding: 5rem 1.5rem 4rem;
      position: relative;
    }

    .hero-content {
      position: relative;
      display: inline-block;
      padding: 3rem 4rem;
    }

    .hero-content::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: #E8E4DF;
      border-radius: 60% 40% 50% 50% / 50% 50% 40% 60%;
      z-index: -1;
      transform: rotate(-2deg);
    }

    .hero h1 {
      font-family: 'DM Serif Display', serif;
      font-size: 3.5rem;
      font-weight: 400;
      margin-bottom: 1rem;
      letter-spacing: -0.02em;
    }

    .hero h1 span {
      font-family: 'DM Sans', sans-serif;
      font-style: italic;
      font-weight: 500;
    }

    .tagline {
      font-size: 1.15rem;
      color: var(--text-muted);
      margin-bottom: 2rem;
      max-width: 500px;
      margin-left: auto;
      margin-right: auto;
    }

    .badges {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 0.5rem;
      margin-bottom: 2rem;
    }

    .badge {
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
      background: var(--green-dark);
      border-radius: 20px;
      padding: 0.4rem 0.85rem;
      font-size: 0.8rem;
      color: var(--text-light);
      text-decoration: none;
      transition: background 0.2s;
    }

    .badge:hover {
      background: var(--green-light);
    }

    .cta-buttons {
      display: flex;
      justify-content: center;
      gap: 1rem;
      flex-wrap: wrap;
    }

    .cta {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.85rem 1.75rem;
      border-radius: 30px;
      font-weight: 600;
      text-decoration: none;
      transition: all 0.2s;
      font-size: 0.95rem;
    }

    .cta-primary {
      background: var(--bg-card);
      color: var(--text-light);
      border: 2px solid var(--bg-card);
    }

    .cta-primary:hover {
      background: #333;
    }

    .cta-secondary {
      background: transparent;
      color: var(--text-dark);
      border: 2px solid var(--bg-card);
    }

    .cta-secondary:hover {
      background: var(--bg-card);
      color: var(--text-light);
    }

    /* === SECTIONS === */
    section {
      padding: 4rem 0;
    }

    h2 {
      font-family: 'DM Serif Display', serif;
      font-size: 2.25rem;
      font-weight: 400;
      margin-bottom: 0.75rem;
      text-align: center;
    }

    .section-subtitle {
      text-align: center;
      color: var(--text-muted);
      margin-bottom: 2.5rem;
      max-width: 550px;
      margin-left: auto;
      margin-right: auto;
    }

    /* === DEMO === */
    .demo-card {
      background: var(--bg-card);
      border-radius: 24px;
      padding: 2rem;
      color: var(--text-light);
    }

    .demo-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1.5rem;
    }

    @media (max-width: 700px) {
      .demo-grid {
        grid-template-columns: 1fr;
      }
    }

    .demo-panel {
      background: rgba(255,255,255,0.05);
      border-radius: 16px;
      padding: 1.25rem;
    }

    .panel-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.75rem;
    }

    .panel-title {
      font-size: 0.8rem;
      font-weight: 600;
      color: rgba(255,255,255,0.6);
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    textarea {
      width: 100%;
      height: 200px;
      background: rgba(255,255,255,0.08);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 12px;
      color: var(--text-light);
      font-family: 'SF Mono', Consolas, monospace;
      font-size: 13px;
      padding: 0.75rem;
      resize: vertical;
    }

    textarea:focus {
      outline: none;
      border-color: var(--orange);
    }

    textarea::placeholder {
      color: rgba(255,255,255,0.35);
    }

    select {
      background: rgba(255,255,255,0.1);
      border: 1px solid rgba(255,255,255,0.15);
      border-radius: 8px;
      color: var(--text-light);
      padding: 0.3rem 0.6rem;
      font-size: 0.75rem;
      cursor: pointer;
    }

    select option {
      background: white;
      color: var(--text-dark);
    }

    .btn {
      background: var(--orange);
      color: var(--text-dark);
      border: none;
      border-radius: 12px;
      padding: 0.85rem 1.5rem;
      font-size: 0.95rem;
      font-weight: 600;
      cursor: pointer;
      width: 100%;
      margin-top: 1rem;
      transition: all 0.2s;
    }

    .btn:hover {
      filter: brightness(1.1);
    }

    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .output-area {
      min-height: 200px;
      display: flex;
      flex-direction: column;
    }

    .board-container {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(255,255,255,0.05);
      border-radius: 12px;
      padding: 1rem;
      min-height: 180px;
    }

    .board {
      display: grid;
      gap: 3px;
    }

    .cell {
      width: 24px;
      height: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 4px;
      font-weight: 700;
      font-size: 0.75rem;
    }

    .cell.empty {
      background: rgba(255,255,255,0.08);
      color: rgba(255,255,255,0.2);
    }

    .status {
      text-align: center;
      padding: 1rem;
      color: rgba(255,255,255,0.5);
      font-size: 0.9rem;
    }

    .status.error {
      color: #f87171;
    }

    .stats {
      margin-top: 0.75rem;
      padding-top: 0.75rem;
      border-top: 1px solid rgba(255,255,255,0.1);
      font-size: 0.8rem;
      color: rgba(255,255,255,0.5);
      display: flex;
      justify-content: space-between;
    }

    /* === QUICK START === */
    .code-card {
      background: var(--bg-card);
      border-radius: 24px;
      padding: 1.75rem;
      color: var(--text-light);
      font-family: 'SF Mono', Consolas, monospace;
      font-size: 0.875rem;
      overflow-x: auto;
      max-width: 600px;
      margin: 0 auto;
    }

    .code-card code {
      white-space: pre;
      line-height: 1.8;
    }

    .code-comment {
      color: rgba(255,255,255,0.4);
    }

    /* === 19 SHAPES === */
    .shapes-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
      gap: 1rem;
    }

    .shape-card {
      background: var(--bg-card);
      border-radius: 20px;
      padding: 1.25rem;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.75rem;
    }

    .shape-visual {
      display: grid;
      gap: 3px;
    }

    .shape-cell {
      width: 16px;
      height: 16px;
      border-radius: 3px;
    }

    .shape-cell.filled {
      background: var(--orange);
    }

    .shape-cell.empty {
      background: rgba(255,255,255,0.08);
    }

    .shape-name {
      font-size: 0.75rem;
      color: rgba(255,255,255,0.6);
      font-weight: 500;
    }

    /* === DOCUMENTATION === */
    .doc-links {
      display: flex;
      flex-wrap: wrap;
      gap: 0.75rem;
      justify-content: center;
    }

    .doc-link {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.75rem 1.25rem;
      background: var(--bg-card);
      border-radius: 30px;
      color: var(--text-light);
      text-decoration: none;
      font-size: 0.9rem;
      font-weight: 500;
      transition: all 0.2s;
    }

    .doc-link:hover {
      transform: translateY(-2px);
    }

    /* === GREEN SECTION WITH WAVY TOP === */
    .green-section {
      background: var(--green-dark);
      margin-top: 4rem;
      position: relative;
    }

    .green-section::before {
      content: '';
      position: absolute;
      top: -80px;
      left: 0;
      right: 0;
      height: 100px;
      background: var(--green-dark);
      mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1200 120' preserveAspectRatio='none'%3E%3Cpath d='M0,120 C150,80 300,100 450,60 C600,20 750,80 900,40 C1050,0 1150,60 1200,40 L1200,120 Z' fill='%231B4332'/%3E%3C/svg%3E");
      -webkit-mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1200 120' preserveAspectRatio='none'%3E%3Cpath d='M0,120 C150,80 300,100 450,60 C600,20 750,80 900,40 C1050,0 1150,60 1200,40 L1200,120 Z' fill='%231B4332'/%3E%3C/svg%3E");
      mask-size: 100% 100%;
      -webkit-mask-size: 100% 100%;
    }

    .green-section .container {
      position: relative;
      z-index: 1;
    }

    .green-section h2 {
      color: var(--text-light);
    }

    .green-section .section-subtitle {
      color: rgba(255,255,255,0.7);
    }

    /* === FOOTER === */
    footer {
      text-align: center;
      padding: 3rem 1.5rem;
      color: var(--text-light);
      font-size: 0.85rem;
    }

    footer a {
      color: var(--text-light);
      text-decoration: none;
      font-weight: 500;
      opacity: 0.85;
    }

    footer a:hover {
      opacity: 1;
      text-decoration: underline;
    }

    /* Piece colors for board output */
    .piece-A { background: #f87171; color: #1a1a1a; }
    .piece-B { background: #fb923c; color: #1a1a1a; }
    .piece-C { background: #facc15; color: #1a1a1a; }
    .piece-D { background: #a3e635; color: #1a1a1a; }
    .piece-E { background: #4ade80; color: #1a1a1a; }
    .piece-F { background: #2dd4bf; color: #1a1a1a; }
    .piece-G { background: #22d3ee; color: #1a1a1a; }
    .piece-H { background: #60a5fa; color: #1a1a1a; }
    .piece-I { background: #a78bfa; color: #1a1a1a; }
    .piece-J { background: #e879f9; color: #1a1a1a; }
    .piece-K { background: #fb7185; color: #1a1a1a; }
    .piece-L { background: #f472b6; color: #1a1a1a; }
    .piece-M { background: #c084fc; color: #1a1a1a; }
    .piece-N { background: #818cf8; color: #1a1a1a; }
    .piece-O { background: #38bdf8; color: #1a1a1a; }
    .piece-P { background: #34d399; color: #1a1a1a; }
    .piece-Q { background: #a8a29e; color: #1a1a1a; }
    .piece-R { background: #fbbf24; color: #1a1a1a; }
    .piece-S { background: #f97316; color: #1a1a1a; }
    .piece-T { background: #ef4444; color: #1a1a1a; }
    .piece-U { background: #ec4899; color: #1a1a1a; }
    .piece-V { background: #8b5cf6; color: #1a1a1a; }
    .piece-W { background: #6366f1; color: #1a1a1a; }
    .piece-X { background: #0ea5e9; color: #1a1a1a; }
    .piece-Y { background: #14b8a6; color: #1a1a1a; }
    .piece-Z { background: #84cc16; color: #1a1a1a; }
  </style>
</head>
<body>

  <!-- HERO -->
  <header class="hero">
    <div class="hero-content">
      <h1>Pack tetrominoes, <span>perfectly</span></h1>
      <p class="tagline">Find the smallest square grid that fits all your Tetris pieces using a backtracking algorithm.</p>

      <div class="badges">
        <span class="badge">Go 1.25+</span>
        <a href="https://github.com/terry-xyz/tetris-optimizer/blob/main/LICENSE" class="badge">MIT License</a>
        <span class="badge">Zero Dependencies</span>
        <span class="badge">5-min Timeout</span>
      </div>

      <div class="cta-buttons">
        <a href="https://github.com/terry-xyz/tetris-optimizer" class="cta cta-secondary">
          View on GitHub
        </a>
        <a href="#demo" class="cta cta-primary">
          Try Demo
        </a>
      </div>
    </div>
  </header>

  <main class="container">

    <!-- LIVE DEMO -->
    <section id="demo">
      <h2>Try it live</h2>
      <p class="section-subtitle">Enter tetromino definitions or pick an example to see the solver in action.</p>

      <div class="demo-card">
        <div class="demo-grid">
          <div class="demo-panel">
            <div class="panel-header">
              <span class="panel-title">Input</span>
              <select id="examples" onchange="loadExample()">
                <option value="">Examples</option>
                <option value="single">Single piece</option>
                <option value="two">Two pieces</option>
                <option value="four">Four pieces</option>
                <option value="complex">Six pieces</option>
              </select>
            </div>
            <textarea id="input" placeholder="4x4 grid per piece
# = filled, . = empty
Blank line between pieces

##..
##..
....
...."></textarea>
            <button class="btn" id="solveBtn" onclick="solve()">Solve</button>
          </div>

          <div class="demo-panel">
            <div class="panel-header">
              <span class="panel-title">Output</span>
            </div>
            <div class="output-area">
              <div class="board-container" id="boardContainer">
                <div class="status">Select an example to start</div>
              </div>
              <div class="stats" id="stats" style="display: none;">
                <span id="sizeInfo"></span>
                <span id="emptyInfo"></span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- QUICK START -->
    <section id="quickstart">
      <h2>Quick start</h2>
      <p class="section-subtitle">Clone, build, and run in seconds.</p>

      <div class="code-card"><code><span class="code-comment"># Clone and run</span>
git clone https://github.com/terry-xyz/tetris-optimizer.git
cd tetris-optimizer
go run ./cmd input.txt

<span class="code-comment"># Run tests</span>
go test ./...</code></div>
    </section>

    <!-- 19 SHAPES -->
    <section id="shapes">
      <h2>The 19 valid shapes</h2>
      <p class="section-subtitle">7 base tetrominoes √ó rotations = 19 unique variants the solver accepts.</p>

      <div class="shapes-grid" id="shapesGrid"></div>
    </section>

  </main>

  <div class="green-section">
    <div class="container">
      <!-- DOCUMENTATION -->
      <section id="docs">
        <h2>Documentation</h2>
        <p class="section-subtitle">Everything you need to understand and contribute.</p>

        <div class="doc-links">
          <a href="https://github.com/terry-xyz/tetris-optimizer/blob/main/README.md" class="doc-link">
            üìÑ README
          </a>
          <a href="https://github.com/terry-xyz/tetris-optimizer/blob/main/CONTRIBUTING.md" class="doc-link">
            ü§ù Contributing
          </a>
          <a href="https://github.com/terry-xyz/tetris-optimizer/blob/main/LICENSE" class="doc-link">
            üìú License
          </a>
          <a href="https://github.com/terry-xyz/tetris-optimizer/issues" class="doc-link">
            üêõ Issues
          </a>
        </div>
      </section>
    </div>

    <footer>
      <p>
        Built with ‚ù§Ô∏è using Go &nbsp;¬∑&nbsp;
        <a href="https://github.com/terry-xyz/tetris-optimizer">GitHub</a> &nbsp;
      </p>
    </footer>
  </div>

  <script>
    // === Shape definitions for visual display ===
    const SHAPE_DATA = [
      { name: 'I horiz', grid: [[1,1,1,1]], color: '#22d3ee' },
      { name: 'I vert', grid: [[1],[1],[1],[1]], color: '#22d3ee' },
      { name: 'O', grid: [[1,1],[1,1]], color: '#facc15' },
      { name: 'T down', grid: [[1,1,1],[0,1,0]], color: '#a78bfa' },
      { name: 'T right', grid: [[1,0],[1,1],[1,0]], color: '#a78bfa' },
      { name: 'T up', grid: [[0,1,0],[1,1,1]], color: '#a78bfa' },
      { name: 'T left', grid: [[0,1],[1,1],[0,1]], color: '#a78bfa' },
      { name: 'S horiz', grid: [[0,1,1],[1,1,0]], color: '#4ade80' },
      { name: 'S vert', grid: [[1,0],[1,1],[0,1]], color: '#4ade80' },
      { name: 'Z horiz', grid: [[1,1,0],[0,1,1]], color: '#f87171' },
      { name: 'Z vert', grid: [[0,1],[1,1],[1,0]], color: '#f87171' },
      { name: 'L up', grid: [[1,0],[1,0],[1,1]], color: '#fb923c' },
      { name: 'L right', grid: [[1,1,1],[1,0,0]], color: '#fb923c' },
      { name: 'L down', grid: [[1,1],[0,1],[0,1]], color: '#fb923c' },
      { name: 'L left', grid: [[0,0,1],[1,1,1]], color: '#fb923c' },
      { name: 'J up', grid: [[0,1],[0,1],[1,1]], color: '#60a5fa' },
      { name: 'J right', grid: [[1,0,0],[1,1,1]], color: '#60a5fa' },
      { name: 'J down', grid: [[1,1],[1,0],[1,0]], color: '#60a5fa' },
      { name: 'J left', grid: [[1,1,1],[0,0,1]], color: '#60a5fa' }
    ];

    // Render shape cards
    function renderShapes() {
      const container = document.getElementById('shapesGrid');
      SHAPE_DATA.forEach(shape => {
        const card = document.createElement('div');
        card.className = 'shape-card';

        const visual = document.createElement('div');
        visual.className = 'shape-visual';
        visual.style.gridTemplateColumns = `repeat(${shape.grid[0].length}, 16px)`;

        shape.grid.forEach(row => {
          row.forEach(cell => {
            const cellEl = document.createElement('div');
            cellEl.className = 'shape-cell ' + (cell ? 'filled' : 'empty');
            if (cell) cellEl.style.background = shape.color;
            visual.appendChild(cellEl);
          });
        });

        const name = document.createElement('div');
        name.className = 'shape-name';
        name.textContent = shape.name;

        card.appendChild(visual);
        card.appendChild(name);
        container.appendChild(card);
      });
    }

    renderShapes();

    // === Solver Logic ===
    const CANONICAL_SHAPES = [
      [[0,0], [0,1], [0,2], [0,3]], [[0,0], [1,0], [2,0], [3,0]],
      [[0,0], [0,1], [1,0], [1,1]],
      [[0,0], [0,1], [0,2], [1,1]], [[0,0], [1,0], [1,1], [2,0]],
      [[0,1], [1,0], [1,1], [1,2]], [[0,1], [1,0], [1,1], [2,1]],
      [[0,1], [0,2], [1,0], [1,1]], [[0,0], [1,0], [1,1], [2,1]],
      [[0,0], [0,1], [1,1], [1,2]], [[0,1], [1,0], [1,1], [2,0]],
      [[0,0], [1,0], [2,0], [2,1]], [[0,0], [0,1], [0,2], [1,0]],
      [[0,0], [0,1], [1,1], [2,1]], [[0,2], [1,0], [1,1], [1,2]],
      [[0,1], [1,1], [2,0], [2,1]], [[0,0], [1,0], [1,1], [1,2]],
      [[0,0], [0,1], [1,0], [2,0]], [[0,0], [0,1], [0,2], [1,2]]
    ];

    const EXAMPLES = {
      single: `##..
##..
....
....`,
      two: `##..
##..
....
....

....
####
....
....`,
      four: `...#
...#
...#
...#

....
....
..##
..##

....
....
....
####

....
##..
.#..
.#..`,
      complex: `##..
.##.
....
....

.##.
##..
....
....

##..
##..
....
....

....
####
....
....

#...
###.
....
....

....
###.
..#.
....`
    };

    function parseInput(text) {
      const lines = text.replace(/\r/g, '').split('\n');
      while (lines.length > 0 && lines[lines.length - 1] === '') lines.pop();
      if (lines.length === 0) throw new Error('Empty input');

      const pieces = [];
      let i = 0, pieceNum = 0;

      while (i < lines.length) {
        pieceNum++;
        if (pieceNum > 26) throw new Error('Too many pieces (max 26)');
        if (i + 4 > lines.length) throw new Error(`Piece ${pieceNum}: incomplete`);

        const pieceLines = lines.slice(i, i + 4);
        i += 4;

        for (let j = 0; j < 4; j++) {
          if (pieceLines[j].length !== 4) throw new Error(`Piece ${pieceNum}, line ${j + 1}: expected 4 chars`);
          for (const ch of pieceLines[j]) if (ch !== '#' && ch !== '.') throw new Error(`Piece ${pieceNum}: invalid char '${ch}'`);
        }

        const coords = [];
        for (let r = 0; r < 4; r++) for (let c = 0; c < 4; c++) if (pieceLines[r][c] === '#') coords.push([r, c]);
        if (coords.length !== 4) throw new Error(`Piece ${pieceNum}: has ${coords.length} cells (expected 4)`);

        const normalized = normalize(coords);
        if (!matchShape(normalized)) throw new Error(`Piece ${pieceNum}: invalid shape`);

        pieces.push({ label: String.fromCharCode(65 + pieceNum - 1), coords: normalized });

        if (i < lines.length) {
          if (lines[i] !== '') throw new Error(`Missing blank line after piece ${pieceNum}`);
          i++;
          if (i < lines.length && lines[i] === '') throw new Error('Consecutive blank lines not allowed');
        }
      }
      if (pieces.length === 0) throw new Error('No tetrominoes found');
      return pieces;
    }

    function normalize(coords) {
      if (coords.length === 0) return coords;
      let minRow = coords[0][0], minCol = coords[0][1];
      for (const [r, c] of coords) { if (r < minRow) minRow = r; if (c < minCol) minCol = c; }
      const normalized = coords.map(([r, c]) => [r - minRow, c - minCol]);
      normalized.sort((a, b) => a[0] !== b[0] ? a[0] - b[0] : a[1] - b[1]);
      return normalized;
    }

    function matchShape(coords) {
      if (coords.length !== 4) return false;
      for (const shape of CANONICAL_SHAPES) if (pointsEqual(coords, shape)) return true;
      return false;
    }

    function pointsEqual(a, b) {
      if (a.length !== b.length) return false;
      for (let i = 0; i < a.length; i++) if (a[i][0] !== b[i][0] || a[i][1] !== b[i][1]) return false;
      return true;
    }

    function createBoard(size) {
      const grid = [];
      for (let i = 0; i < size; i++) grid.push(new Array(size).fill('.'));
      return { grid, size };
    }

    function copyBoard(board) {
      return { grid: board.grid.map(row => [...row]), size: board.size };
    }

    function canPlace(board, piece, row, col) {
      for (const [r, c] of piece.coords) {
        const newR = row + r, newC = col + c;
        if (newR < 0 || newR >= board.size || newC < 0 || newC >= board.size) return false;
      }
      for (const [r, c] of piece.coords) if (board.grid[row + r][col + c] !== '.') return false;
      return true;
    }

    function place(board, piece, row, col) {
      for (const [r, c] of piece.coords) board.grid[row + r][col + c] = piece.label;
    }

    function solvePuzzle(pieces, maxTime = 5000) {
      if (pieces.length === 0) return { board: createBoard(0), timeout: false };
      const minSize = Math.ceil(Math.sqrt(4 * pieces.length));
      const startTime = Date.now();

      for (let size = minSize; size <= 20; size++) {
        if (Date.now() - startTime > maxTime) return { board: null, timeout: true };
        const board = createBoard(size);
        if (solveRecursive(board, pieces, 0, startTime, maxTime)) return { board, timeout: false };
      }
      return { board: null, timeout: true };
    }

    function solveRecursive(board, pieces, idx, startTime, maxTime) {
      if (Date.now() - startTime > maxTime) return false;
      if (idx >= pieces.length) return true;
      const piece = pieces[idx];

      for (let row = 0; row < board.size; row++) {
        for (let col = 0; col < board.size; col++) {
          if (canPlace(board, piece, row, col)) {
            const newBoard = copyBoard(board);
            place(newBoard, piece, row, col);
            if (solveRecursive(newBoard, pieces, idx + 1, startTime, maxTime)) {
              board.grid = newBoard.grid;
              return true;
            }
          }
        }
      }
      return false;
    }

    function loadExample() {
      const select = document.getElementById('examples');
      if (select.value && EXAMPLES[select.value]) document.getElementById('input').value = EXAMPLES[select.value];
      select.value = '';
    }

    function solve() {
      const input = document.getElementById('input').value;
      const container = document.getElementById('boardContainer');
      const stats = document.getElementById('stats');
      const btn = document.getElementById('solveBtn');

      btn.disabled = true;
      btn.textContent = 'Solving...';
      container.innerHTML = '<div class="status">Solving...</div>';
      stats.style.display = 'none';

      setTimeout(() => {
        try {
          const pieces = parseInput(input);
          const result = solvePuzzle(pieces);

          if (result.timeout) {
            container.innerHTML = '<div class="status error">Timeout ‚Äî try fewer pieces or clone the main program</div>';
          } else {
            renderBoard(result.board, container);
            const emptyCount = countEmpty(result.board);
            document.getElementById('sizeInfo').textContent = `${result.board.size}√ó${result.board.size} grid`;
            document.getElementById('emptyInfo').textContent = `${emptyCount} empty`;
            stats.style.display = 'flex';
          }
        } catch (e) {
          container.innerHTML = `<div class="status error">${e.message}</div>`;
        }
        btn.disabled = false;
        btn.textContent = 'Solve';
      }, 10);
    }

    function renderBoard(board, container) {
      if (board.size === 0) { container.innerHTML = '<div class="status">Empty solution</div>'; return; }
      const boardEl = document.createElement('div');
      boardEl.className = 'board';
      boardEl.style.gridTemplateColumns = `repeat(${board.size}, 24px)`;

      for (let r = 0; r < board.size; r++) {
        for (let c = 0; c < board.size; c++) {
          const cell = document.createElement('div');
          const value = board.grid[r][c];
          cell.className = 'cell';
          if (value === '.') { cell.classList.add('empty'); }
          else { cell.classList.add(`piece-${value}`); cell.textContent = value; }
          boardEl.appendChild(cell);
        }
      }
      container.innerHTML = '';
      container.appendChild(boardEl);
    }

    function countEmpty(board) {
      let count = 0;
      for (const row of board.grid) for (const cell of row) if (cell === '.') count++;
      return count;
    }
  </script>
</body>
</html>
